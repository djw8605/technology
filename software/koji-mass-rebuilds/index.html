



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    

      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://opensciencegrid.github.io/technology/software/koji-mass-rebuilds/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-0.17.5, mkdocs-material-2.9.4">
    
    
      
        <title>Koji Mass Rebuilds - OSG Technology Area</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#mass-rpm-rebuilds-for-a-new-build-target-in-koji" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://opensciencegrid.github.io/technology/" title="OSG Technology Area" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                OSG Technology Area
              </span>
              <span class="md-header-nav__topic">
                Koji Mass Rebuilds
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/opensciencegrid/technology/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://opensciencegrid.github.io/technology/" title="OSG Technology Area" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    OSG Technology Area
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/opensciencegrid/technology/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Software
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Software
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1" checked>
    
    <label class="md-nav__link" for="nav-2-1">
      Packaging
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        Packaging
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../rpm-development-guide/" title="RPM Development Guide" class="md-nav__link">
      RPM Development Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../osg-build-tools/" title="OSG Build Tools" class="md-nav__link">
      OSG Build Tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../quilt/" title="Using Quilt" class="md-nav__link">
      Using Quilt
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../upcoming-to-main/" title="Upcoming to Main" class="md-nav__link">
      Upcoming to Main
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../koji-workflow/" title="Koji Workflow" class="md-nav__link">
      Koji Workflow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../create-vo-client/" title="Creating the VO Client Package" class="md-nav__link">
      Creating the VO Client Package
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../repository-management/" title="Repository Management" class="md-nav__link">
      Repository Management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../globus-mass-update-procedure/" title="Globus Mass Update Procedure" class="md-nav__link">
      Globus Mass Update Procedure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../resurrecting-epel-packages/" title="Resurrecting Epel Packages" class="md-nav__link">
      Resurrecting Epel Packages
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Koji Mass Rebuilds
      </label>
    
    <a href="./" title="Koji Mass Rebuilds" class="md-nav__link md-nav__link--active">
      Koji Mass Rebuilds
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#new-rhel-version-vs-new-osg-series" title="New RHEL version vs new OSG series" class="md-nav__link">
    New RHEL version vs new OSG series
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#new-rhel-version" title="New RHEL version" class="md-nav__link">
    New RHEL version
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#new-osg-series" title="New OSG series" class="md-nav__link">
    New OSG series
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doing-scratch-builds-of-everything-first" title="Doing scratch builds of everything first" class="md-nav__link">
    Doing scratch builds of everything first
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#options-for-calculating-build-dependencies" title="Options for calculating build dependencies" class="md-nav__link">
    Options for calculating build dependencies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pre-computing-predictive-vs-just-in-time" title="Pre-computing (predictive) vs just-in-time" class="md-nav__link">
    Pre-computing (predictive) vs just-in-time
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#package-list-closure-pruning" title="Package list closure, pruning" class="md-nav__link">
    Package list closure, pruning
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proposal-recommendations" title="Proposal / Recommendations" class="md-nav__link">
    Proposal / Recommendations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-a-new-osg-series" title="For a new OSG series:" class="md-nav__link">
    For a new OSG series:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-a-new-rhel-version" title="For a new RHEL version:" class="md-nav__link">
    For a new RHEL version:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Development
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Development
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../development-process/" title="Development Process" class="md-nav__link">
      Development Process
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../git-software-development/" title="Git Software Development Process" class="md-nav__link">
      Git Software Development Process
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ce-test-scaling/" title="CE Scale Testing" class="md-nav__link">
      CE Scale Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ipv6-testing/" title="IPv6 Testing" class="md-nav__link">
      IPv6 Testing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../policy/software-support/" title="Software Support" class="md-nav__link">
      Software Support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../effort-tracking/" title="Effort Tracking" class="md-nav__link">
      Effort Tracking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../release-planning/" title="Release Planning" class="md-nav__link">
      Release Planning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../new-team-member/" title="New Team Member" class="md-nav__link">
      New Team Member
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Release
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Release
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../release/cut-sw-release/" title="How to Cut a Release" class="md-nav__link">
      How to Cut a Release
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../release/cut-data-release/" title="How to Cut a Data Release" class="md-nav__link">
      How to Cut a Data Release
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../release/new-release-series/" title="New Release Series" class="md-nav__link">
      New Release Series
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../release/old-release-removal/" title="Old Release Series Removal" class="md-nav__link">
      Old Release Series Removal
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../release/itb-testing/" title="ITB Prerelease Testing" class="md-nav__link">
      ITB Prerelease Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../release/empty-pkgs/" title="Empty Packages" class="md-nav__link">
      Empty Packages
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../release/acceptance-testing/" title="Acceptance Testing" class="md-nav__link">
      Acceptance Testing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Policy
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Policy
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../policy/campus-cyberinfrastructure/" title="Campus Cyberinfrastructure" class="md-nav__link">
      Campus Cyberinfrastructure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../policy/cream-support/" title="CREAM-CE Support" class="md-nav__link">
      CREAM-CE Support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../policy/service-migrations-spring-2018/" title="Service Migrations - Spring 2018" class="md-nav__link">
      Service Migrations - Spring 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../policy/gums-retire/" title="GUMS Retirement" class="md-nav__link">
      GUMS Retirement
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../policy/bestman2-retire/" title="BeStMan2 Retirement" class="md-nav__link">
      BeStMan2 Retirement
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../policy/voms-admin-retire/" title="VOMS Admin Retirement" class="md-nav__link">
      VOMS Admin Retirement
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../policy/release-series/" title="Release Series Support" class="md-nav__link">
      Release Series Support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../policy/globus-toolkit/" title="Globus Toolkit Support" class="md-nav__link">
      Globus Toolkit Support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../policy/external-oasis-repos/" title="OASIS Repository Mirroring" class="md-nav__link">
      OASIS Repository Mirroring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../policy/flexible-release-model/" title="Flexible Release Model" class="md-nav__link">
      Flexible Release Model
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../policy/software-release/" title="Software Release Policy" class="md-nav__link">
      Software Release Policy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../policy/container-release/" title="Container Release Policy" class="md-nav__link">
      Container Release Policy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../policy/community-testing/" title="Community Testing" class="md-nav__link">
      Community Testing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/writing-documentation/" title="Writing Documentation" class="md-nav__link">
      Writing Documentation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/reviewing-documentation/" title="Reviewing Documentation" class="md-nav__link">
      Reviewing Documentation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/style-guide/" title="Markdown Style Guide" class="md-nav__link">
      Markdown Style Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/new-doc-area/" title="Creating a New Area" class="md-nav__link">
      Creating a New Area
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Historical Transitions
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Historical Transitions
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/sha2-support/" title="SHA-2 Support" class="md-nav__link">
      SHA-2 Support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/markdown-migration/" title="Migrating Documents to Markdown" class="md-nav__link">
      Migrating Documents to Markdown
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Meetings
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Meetings
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20191202/" title="December, 2 2019" class="md-nav__link">
      December, 2 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20191125/" title="November, 25 2019" class="md-nav__link">
      November, 25 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20191118/" title="November, 18 2019" class="md-nav__link">
      November, 18 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20191111/" title="November, 11 2019" class="md-nav__link">
      November, 11 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20191104/" title="November, 4 2019" class="md-nav__link">
      November, 4 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20191028/" title="October, 28 2019" class="md-nav__link">
      October, 28 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20191021/" title="October, 21 2019" class="md-nav__link">
      October, 21 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20191014/" title="October, 14 2019" class="md-nav__link">
      October, 14 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20191007/" title="October, 7 2019" class="md-nav__link">
      October, 7 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190930/" title="September, 30 2019" class="md-nav__link">
      September, 30 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190923/" title="September, 23 2019" class="md-nav__link">
      September, 23 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190916/" title="September, 16 2019" class="md-nav__link">
      September, 16 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190909/" title="September, 9 2019" class="md-nav__link">
      September, 9 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190826/" title="August, 26 2019" class="md-nav__link">
      August, 26 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190819/" title="August, 19 2019" class="md-nav__link">
      August, 19 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190812/" title="August, 12 2019" class="md-nav__link">
      August, 12 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190805/" title="August, 5 2019" class="md-nav__link">
      August, 5 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190729/" title="July 29, 2019" class="md-nav__link">
      July 29, 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190722/" title="July 22, 2019" class="md-nav__link">
      July 22, 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190708/" title="July 8, 2019" class="md-nav__link">
      July 8, 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190701/" title="July 1, 2019" class="md-nav__link">
      July 1, 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190624/" title="June 24, 2019" class="md-nav__link">
      June 24, 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190617/" title="June 17, 2019" class="md-nav__link">
      June 17, 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190610/" title="June 10, 2019" class="md-nav__link">
      June 10, 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190603/" title="June 3, 2019" class="md-nav__link">
      June 3, 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190528/" title="May 28, 2019" class="md-nav__link">
      May 28, 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190513/" title="May 13, 2019" class="md-nav__link">
      May 13, 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190506/" title="May 6, 2019" class="md-nav__link">
      May 6, 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190429/" title="April 29, 2019" class="md-nav__link">
      April 29, 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190422/" title="April 22, 2019" class="md-nav__link">
      April 22, 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190415/" title="April 15, 2019" class="md-nav__link">
      April 15, 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190408/" title="April 8, 2019" class="md-nav__link">
      April 8, 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190401/" title="April 1, 2019" class="md-nav__link">
      April 1, 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190325/" title="March 25, 2019" class="md-nav__link">
      March 25, 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190311/" title="March 11, 2019" class="md-nav__link">
      March 11, 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190304/" title="March 4, 2019" class="md-nav__link">
      March 4, 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190225/" title="February 25, 2019" class="md-nav__link">
      February 25, 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190218/" title="February 18, 2019" class="md-nav__link">
      February 18, 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190211/" title="February 11, 2019" class="md-nav__link">
      February 11, 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190204/" title="February 4, 2019" class="md-nav__link">
      February 4, 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190128/" title="January 28, 2019" class="md-nav__link">
      January 28, 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190122/" title="January 22, 2019" class="md-nav__link">
      January 22, 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190114/" title="January 14, 2019" class="md-nav__link">
      January 14, 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2019/TechArea20190107/" title="January 7, 2019" class="md-nav__link">
      January 7, 2019
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#new-rhel-version-vs-new-osg-series" title="New RHEL version vs new OSG series" class="md-nav__link">
    New RHEL version vs new OSG series
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#new-rhel-version" title="New RHEL version" class="md-nav__link">
    New RHEL version
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#new-osg-series" title="New OSG series" class="md-nav__link">
    New OSG series
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doing-scratch-builds-of-everything-first" title="Doing scratch builds of everything first" class="md-nav__link">
    Doing scratch builds of everything first
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#options-for-calculating-build-dependencies" title="Options for calculating build dependencies" class="md-nav__link">
    Options for calculating build dependencies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pre-computing-predictive-vs-just-in-time" title="Pre-computing (predictive) vs just-in-time" class="md-nav__link">
    Pre-computing (predictive) vs just-in-time
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#package-list-closure-pruning" title="Package list closure, pruning" class="md-nav__link">
    Package list closure, pruning
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proposal-recommendations" title="Proposal / Recommendations" class="md-nav__link">
    Proposal / Recommendations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-a-new-osg-series" title="For a new OSG series:" class="md-nav__link">
    For a new OSG series:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-a-new-rhel-version" title="For a new RHEL version:" class="md-nav__link">
    For a new RHEL version:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/opensciencegrid/technology/edit/master/docs/software/koji-mass-rebuilds.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="mass-rpm-rebuilds-for-a-new-build-target-in-koji">Mass RPM Rebuilds for a new Build Target in Koji<a class="headerlink" href="#mass-rpm-rebuilds-for-a-new-build-target-in-koji" title="Permanent link">&para;</a></h1>
<p>Whenever we move to a new OSG series (OSG 3.3) and/or a new RHEL version (EL7), we want to make new builds for all of our packages in the new koji build target (osg-3.3-el7). Due to tricky build dependencies and unexpected build failures, this can be a messy task; and in the past we have gone about it in an ad-hoc manner.</p>
<p>This document will discuss some of the aspects of the task and issues involved, some possible approaches, and ultimately a proposal for a general tool or procedure for doing our mass rebuilds.</p>
<h2 id="new-rhel-version-vs-new-osg-series">New RHEL version vs new OSG series<a class="headerlink" href="#new-rhel-version-vs-new-osg-series" title="Permanent link">&para;</a></h2>
<h3 id="new-rhel-version">New RHEL version<a class="headerlink" href="#new-rhel-version" title="Permanent link">&para;</a></h3>
<p>For a new RHEL version, we start with no osg packages to build against, so we are forced to build things in dependency order. Figuring out the dependency order is possibly the most difficult (or interesting) part of doing mass rebuilds -- more on that later.</p>
<h3 id="new-osg-series">New OSG series<a class="headerlink" href="#new-osg-series" title="Permanent link">&para;</a></h3>
<p>For a new OSG series within an existing RHEL version, we have more options. While it's possible to "start from scratch" the same way we would with a new RHEL version and build everything in dependency order, this is not really necessary if we take advantage of existing builds from the previous series.</p>
<p>A prior step is to determine the package list for the new series -- this will be some combination of Upcoming and the current release series, minus any packages pruned for the new series. This should also be reflected in the new trunk packaging area. All the current builds for packages in that list (from upcoming + current series) can be tagged into the new *-development (or *-build) repos. This should make all of the build dependencies available for mass rebuilding the new series all at once (osg-build koji *).</p>
<p>After some consideration, I wholeheartedly endorse this approach for new OSG series -- for all but academic exercises. Rebuilding in dependency order when all the dependencies are already built just seems like wasted effort.</p>
<h2 id="doing-scratch-builds-of-everything-first">Doing scratch builds of everything first<a class="headerlink" href="#doing-scratch-builds-of-everything-first" title="Permanent link">&para;</a></h2>
<p>Before doing the mass rebuilds in a new build target, it seems to be a good idea to do scratch builds of all the packages in the current series first. (Or, at least the ones we intend to bring into the new build target.) This will give us a chance to see any build failures that have crept in (possibly due to upstream changes in the OS or EPEL), and fix them first if desired, but in any case avoid the confusion of seeing the failures for the first time in the new build target.</p>
<p>Doing mass scratch rebuilds for an existing series is easy, as they can all be done at once.</p>
<p>Relatedly, doing a round of scratch builds <strong>after</strong> successfully building all packages into a new build target can also be useful, because it can reveal dependency issues only present in the new set of builds. Doing developer test installs or a round of VMU tests may also uncover any runtime dependency issues.</p>
<h2 id="options-for-calculating-build-dependencies">Options for calculating build dependencies<a class="headerlink" href="#options-for-calculating-build-dependencies" title="Permanent link">&para;</a></h2>
<p>We can get dependency information from a number of places:</p>
<ul>
<li>scraping .spec files for Requires/BuildRequires/Provides and <code>%package</code> names</li>
<li>querying existing rpms directly on koji-hub and our OS/EPEL mirrors (<code>rpm -q</code>)</li>
<li>querying srpms from <code>osg-build prebuild</code> directly for build requirements</li>
<li>inspecting previous buildroots to determine resolved build dependencies</li>
<li>use <code>repoquery</code> to determine whatrequires/whatprovides for packages</li>
<li>use <code>yum-builddep</code> to find packages with all build requirements available</li>
<li>using the repodata (primary+filelists) from rpm repositories, including:</li>
<li>upcoming + 3.X development + external repos (Centos/EPEL/JPackage), OR</li>
<li>osg-upcoming-elX-build, which includes them all</li>
</ul>
<p>One important aspect is that the runtime requirements are also relevant for determining build requirements, since a build will require installing all of the runtime requirements of the packages required for the build.</p>
<p>That is, <code>(A BuildRequires B) and (B Requires C)</code> implies <code>A BuildRequires C</code>.</p>
<p>Combined with the fact that runtime requirements are transitive, that is, <code>(A Requires B) and (B Requires C)</code> implies <code>A Requires C</code>, computing build requirements is a recursive operation, which can be many levels deep.</p>
<p>Another question to keep in mind is whether to use versioned requires/provides (i.e., BuildRequires xyz &gt;= 1.2-3) or to only pay attention to the package/capability names. Similarly, whether to pay any attention to conflicts/obsoletes. These would add complexity to anything except the standard tools (repoquery, yum-builddep) which already take these things into account. (And we may get pretty far even without paying attention to versions.)</p>
<p>Note also that the dependencies/capabilities for a given package often varies between different rhel versions.</p>
<h2 id="pre-computing-predictive-vs-just-in-time">Pre-computing (predictive) vs just-in-time<a class="headerlink" href="#pre-computing-predictive-vs-just-in-time" title="Permanent link">&para;</a></h2>
<p>Two different approaches to determining dependency order for building are:</p>
<ul>
<li>pre compute all dependencies based on an existing series/rhel version, OR</li>
<li>compute which remaining packages have all build reqs satisfied now</li>
</ul>
<p>The first approach has the benefit of being able to determine the packages that need to be built in order to accomplish a smaller subset goal first -- for example, to be able to install osg-wn-client. (And, if there are problems with resolving certain dependencies (say with osg-wn-client again), it will become apparent earlier, as opposed to not until all possible-to-build packages have been built.) The limitation of this approach is that the predicted set of files/capabilities that a binary package will provide may differ between osg series/rhel versions, and as a result may be inaccurate for the new build target.</p>
<p>The second approach provides somewhat more confidence about being able to correctly determine which packages should be buildable at any point in time, but (as mentioned above) it is a bit more in the dark about seeing the bigger picture of the dependency graph or being able to build subsets of targets.</p>
<p>It may be useful to have both options available -- building from the list in the second approach, but using the first mechanism to have a better picture of where things are at, or perhaps to steer toward finishing a certain subset of packages first.</p>
<h2 id="package-list-closure-pruning">Package list closure, pruning<a class="headerlink" href="#package-list-closure-pruning" title="Permanent link">&para;</a></h2>
<p>At some point (either in the planning stage or after building packages into the new build target), we need to ensure that the new osg series/rhel version contains all of its install requirements for all of its packages. It would probably suffice to do a VMU run that installs each package (perhaps individually, to avoid conflicts).</p>
<p>But if we go about it more analytically, we may also get, as a result, a list of packages which we previously only maintained for the purpose of building our other packages (ie, that were never required at runtime for any use cases that we cared about), which now, in the new target, are no longer build requirements (directly or indirectly) for any packages that we care about installing. Packages in this category could be reviewed to also be dropped from the new build target.</p>
<h2 id="proposal-recommendations">Proposal / Recommendations<a class="headerlink" href="#proposal-recommendations" title="Permanent link">&para;</a></h2>
<p>As mentioned earlier, my recommendation is that we treat a new OSG series differently than a new RHEL version.</p>
<h3 id="for-a-new-osg-series">For a new OSG series:<a class="headerlink" href="#for-a-new-osg-series" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>update native/redhat packaging area to reflect packages for new series, including upcoming + trunk - removed packages</p>
</li>
<li>
<p>tag existing builds of packages in new list into the new development tag (eg, for osg-3.3-el6, tag the .osgup.el6 and .osg32.el6 builds into osg-3.3-el6-development)</p>
</li>
<li>
<p>build all packages in new packaging area into new build target at once</p>
</li>
<li>
<p>for all successful builds, remove corresponding old builds (eg, .osgup/.osg32) from the new tag (osg-3.3-el6-development)</p>
</li>
</ul>
<h3 id="for-a-new-rhel-version">For a new RHEL version:<a class="headerlink" href="#for-a-new-rhel-version" title="Permanent link">&para;</a></h3>
<ul>
<li>pull the repodata from the relevant <code>*-build</code> repo from koji:</li>
</ul>
<p>for pre-computing, use a build repo from an existing rhel version:<br />
<a href="https://koji.chtc.wisc.edu/mnt/koji/repos/osg-3.2-el6-build/latest/x86_64/repodata/">https://koji.chtc.wisc.edu/mnt/koji/repos/osg-3.2-el6-build/latest/x86_64/repodata/</a></p>
<p>for just-in-time, use the new build repo:<br />
<a href="https://koji.chtc.wisc.edu/mnt/koji/repos/osg-3.2-el8-build/latest/x86_64/repodata/">https://koji.chtc.wisc.edu/mnt/koji/repos/osg-3.2-el8-build/latest/x86_64/repodata/</a></p>
<p>the primary and filelists (sqlite) files can be used to get runtime requires and provides. (Note that this includes packages from the relevant external repos, also.)</p>
<ul>
<li>generate srpms repodata for the current set of packages to build, with osg-build prebuild and createrepo.</li>
</ul>
<p>the primary (sqlite) file can be used to get build-requires.</p>
<ul>
<li>use sql to resolve direct dependencies at the package name level:<ul>
<li>src-pkg: bin-pkg (BuildRequires)</li>
<li>bin-pkg: bin-pkg (Requires)</li>
<li>bin-pkg: src-pkg (bin-pkg comes from which src-pkg? only needed for pre-computing dependencies)</li>
</ul>
</li>
<li>resolve this list into a full list of recursive build dependencies.</li>
</ul>
<p>Since this is recursive, there is no way to do it in a fixed number of sql queries. However the above input list is already directly consumable by Make, which is designed to handle recursive dependencies just like this. Or we can write a new tool to do it in python.</p>
<ul>
<li>build ready-to-be-built packages</li>
<li>update our copy of the repodata from the regen'ed <code>*-build</code> repo, as often as new versions become available</li>
<li>update our dependency lists</li>
<li>repeat until all packages are built</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../resurrecting-epel-packages/" title="Resurrecting Epel Packages" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Resurrecting Epel Packages
              </span>
            </div>
          </a>
        
        
          <a href="../development-process/" title="Development Process" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Development Process
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.30f6b8b1.js"></script>
      
      <script>app.initialize({version:"0.17.5",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>